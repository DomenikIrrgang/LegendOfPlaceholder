[gd_scene load_steps=12 format=3 uid="uid://1cktjqdfqqvt"]

[ext_resource type="PackedScene" uid="uid://bhfcp6laa8rvu" path="res://Enemy/Enemy.tscn" id="1_delku"]
[ext_resource type="Script" path="res://Enemy/MegaSlime/MegaSlime.gd" id="2_35ve5"]
[ext_resource type="Resource" uid="uid://dp7afxuihduss" path="res://Resources/Enemies/MegaSlime.tres" id="3_gasfo"]
[ext_resource type="Script" path="res://Enemy/MegaSlime/Phase1.gd" id="4_8dkfp"]
[ext_resource type="Script" path="res://State/StateTransition.gd" id="5_4ygdc"]
[ext_resource type="Script" path="res://Enemy/MegaSlime/Phase2.gd" id="6_d1bov"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_cu5s6"]
size = Vector2(38, 12)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_liqmg"]
size = Vector2(45, 19)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_kp00g"]
size = Vector2(40, 15.25)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_bg311"]
size = Vector2(48, 38.5)

[sub_resource type="GDScript" id="GDScript_ojv47"]
script/source = "extends Control

@onready
var progress_bar: TextureProgressBar = $Background/ProgressBar

@onready
var spell_name_label: Label = $Background/CenterContainer/SpellName

func _ready() -> void:
	visible = false

func initialize(unit: Unit) -> void:
	unit.cast_started.connect(on_cast_started)
	unit.cast_canceled.connect(on_cast_canceled)
	unit.cast_interupted.connect(on_cast_interupted)
	unit.cast_finished.connect(on_cast_finished)

func on_cast_started(source: Unit, target: Unit, ability: Ability, duration: float) -> void:
	var tween = create_tween()
	visible = true
	progress_bar.value = 0
	progress_bar.max_value = 1000
	tween.tween_property(progress_bar, \"value\", 1000, duration)
	spell_name_label.text = ability.get_alias()
	
func on_cast_canceled(source: Unit, target: Unit, ability: Ability) -> void:
	visible = false
	
func on_cast_interupted(source: Unit, target: Unit, ability: Ability) -> void:
	visible = false
	
func on_cast_finished(source: Unit, target: Unit, ability: Ability) -> void:
	visible = false
"

[node name="MegaSlime" groups=["boss"] instance=ExtResource("1_delku")]
position = Vector2(0, -15)
motion_mode = 1
safe_margin = 0.01
script = ExtResource("2_35ve5")
unit_data = ExtResource("3_gasfo")

[node name="Collision" parent="." index="0"]
position = Vector2(0, 2)
shape = SubResource("RectangleShape2D_cu5s6")

[node name="Model" parent="." index="1"]
position = Vector2(0, -11)
scale = Vector2(3, 3)

[node name="HurtBoxShape" parent="HurtBox2D" index="0"]
visible = false
position = Vector2(0.5, 3.5)
shape = SubResource("RectangleShape2D_liqmg")

[node name="CollisionShape" parent="HitBox2D" index="0"]
position = Vector2(0, 2)
shape = SubResource("RectangleShape2D_kp00g")

[node name="UnitHpBar" parent="." index="5"]
offset_top = -35.0
offset_bottom = -35.0
metadata/_edit_use_anchors_ = true

[node name="OcclusionCollision" parent="UnitOcclusion" index="0"]
visible = false
position = Vector2(0, -9.75)
shape = SubResource("RectangleShape2D_bg311")

[node name="Phase1" parent="PhaseState" index="0"]
script = ExtResource("4_8dkfp")

[node name="Phase1ToPhase2" type="Node" parent="PhaseState/Phase1" index="0"]
script = ExtResource("5_4ygdc")
target_state_path = NodePath("../../Phase2")

[node name="Phase2" type="Node" parent="PhaseState" index="1"]
script = ExtResource("6_d1bov")

[node name="Castbar" parent="." index="8"]
offset_left = -1.0
offset_top = -50.0
offset_right = 39.0
offset_bottom = -25.0
script = SubResource("GDScript_ojv47")

[node name="CenterContainer" parent="Castbar/Background" index="1"]
offset_top = 0.0
offset_bottom = 25.0
